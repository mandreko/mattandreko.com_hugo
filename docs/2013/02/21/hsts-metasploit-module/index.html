<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta content='width=device-width, initial-scale=1, maximum-scale=1' name='viewport'/>
		<link href="//fonts.googleapis.com/css?family=Raleway:400,700%7COpen+Sans:400,700,400italic" media="all" rel="stylesheet" type="text/css">
		<link href='//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css' rel='stylesheet'/>
		<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
		<meta content='blogger' name='generator'/>
		<link href='http://test.andreko.net//favicon.ico' rel='icon' type='image/x-icon'/>
		<link href='http://test.andreko.net/' rel='canonical'/>
		
		
		<title>HSTS Metasploit Module</title>
		<meta content='YOUR DESCRIPTION HERE' name='description'/>
		<meta content='YOUR KEYWORDS HERE' name='keywords'/>
		
		<meta content='@mandreko' name='twitter:site'/>
		<meta content='@mandreko' name='twitter:creator'/>
		
		<link type="text/css" rel="stylesheet" href="/css/main.css" />
		<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js' type='text/javascript'></script>
		
		<script type="text/javascript">
			var _gaq=[['_setAccount','UA-25280110-1'],['_trackPageview']];
			(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
			g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
			s.parentNode.insertBefore(g,s)}(document,'script'));
		</script>
		
	</head>
	<body class='index'>
	
	<div class='head-wrap'>
		<div class='row' id='header-wrappers'>
			<div class='headerleft'>
				<div class='headerleft section' id='headerleft'>
					<div class='widget Header' data-version='1' id='Header1'>
						<div id='header-inner'>
							<a href='/' style='display: block'><h1 style='display:none'></h1>
								<img alt="Logo" height="55px; " id="Header1_headerimg" src="/img/logo.png" style="display: block" width="311px; ">
							</a>
						</div>
					</div>
				</div>
			</div>
			<div style='clear: both;'></div>
		</div>
	</div>
	<div class='navi-menu'>
		<div class='nav-menu section' id='Navigation Menu' name='Navigation Menu'>
			<div class='widget LinkList' data-version='1' id='LinkList100'>
				<div class='widget-content'>
					<ul id='nav' itemscope='' itemtype='http://schema.org/SiteNavigationElement'>
						<li itemprop='name'><a href='http://test.andreko.net/' itemprop='url'>HOME</a></li>
						<li itemprop='name'><a href='http://test.andreko.net/categories' itemprop='url'>CATEGORIES</a></li>
						<li itemprop='name'><a href='#' itemprop='url'>ARCHIVE</a></li>
						<li itemprop='name'><a href='http://test.andreko.net/resume.pdf' itemprop='url'>RESUME</a></li>
					</ul>
					<select class="selectnav" id="selectnav2">
						<option value="">Menu</option>
						<option value="http://test.andreko.net/">HOME</option>
						<option value="http://test.andreko.net/categories">CATEGORIES</option>
						<option value="#">ARCHIVE</option>
						<option value="http://test.andreko.net/resume.pdf">RESUME</option>
					</select>
				</div>
			</div>
		</div>
		<div class='top-bar-social blue section' id='header social widget' name='Top Social Widget'>
			<div class='widget LinkList' data-version='1' id='LinkList230'>
				<div class='widget-content'>
					<ul id='social'>
						
							<li><a class='facebook' href='https://www.facebook.com/mattandreko' title='facebook'></a></li>
						
						
							<li><a class='twitter' href='https://www.twitter.com/mandreko' title='twitter'></a></li>
						
						
							<li><a class='gplus' href='https://plus.google.com/mandreko' title='gplus'></a></li>
						
						
							<li><a class='linkedin' href='https://www.linkedin.com/mattandreko' title='linkedin'></a></li>
						
						
							<li><a class='stack-overflow' href='http://stackoverflow.com/story/mattandreko' title='stack-overflow'></a></li>
						
						
							<li><a class='github' href='https://www.github.com/mandreko' title='github'></a></li>
						
						
							<li><a class='instagram' href='https://www.instagram.com/mandreko' title='instagram'></a></li>
						
					</ul>
				</div>
			</div>
		</div>
		<div style='clear: both;'></div>
	</div>
	
	<div style='clear: both;'></div>
	<div id="outer-wrapper" class="index home">


<div class='row' id='content-wrapper'>
    <div id='main-wrapper'>
      <div class='main section' id='main'>
      


        <div id="main">
          <div id="content">
            <div>
              <article class="hentry" role="article">

                
                

                <div class="entry-content">
                  
                  
                  

<p>I have been working as a security consultant for a few months now, and one finding that is on almost every webserver I come across, is the lack of an <a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HSTS (HTTP Strict Transport Security)</a> implementation. This is understandable, since HSTS is still fairly new. In fact, before starting at <a href="http://www.accuvant.com">Accuvant</a>, I had never heard of it either! However, since most browsers support it now, I wanted to be able to report on it. As of the time of this post, <a href="https://www.rapid7.com/products/nexpose">Nexpose</a> does not have a finding for this item, but I believe <a href="http://www.tenable.com/products/nessus">Nessus</a> does. To report on this finding, and provide a screenshot evidence to customers, we were often resorting to manually looking at the headers, or implementing home-made scripts to do it.</p>

<!-- more -->

<h2 id="wait-hsts-what-are-you-talking-about">Wait, HSTS? What are you talking about?</h2>

<p>When you visit a website over unsecured HTTP, it&rsquo;s often considered a best practice to do a 302 redirect to the HTTPS site. That way, when browser users just type in the domain, it gets redirected to the secure site. When the &ldquo;Strict-Transport-Security&rdquo; header is added to the HTTPS response, the client then knows for a certain amount of time (based on the header&rsquo;s value) to ONLY request the HTTPS version of the site. This can greatly reduce the chances of phishing.</p>

<p>One convenient thing that will occur with HSTS, is that even if you make requests to the HTTP version of the site, the browser will actually bypass that, and request straight from the HTTPS site. This prevents leaks that often occur with images, stylesheets, and scripts.</p>

<h2 id="get-to-the-module-already">Get to the module already!</h2>

<p>The crew over on the <a href="http://www.metasploit.com">Metasploit</a> team were really quick adding this module, which isn&rsquo;t surprising since it was super easy to implement. I was honestly surprised that nobody had done it already. The code can be found <a href="https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/scanner/http/http_hsts.rb">here</a>.</p>

<h2 id="so-how-do-i-use-this-thing">So how do I use this thing?</h2>

<p>The usage is pretty simple. First, load up Metasploit and gaze at the ASCII-art:</p>

<pre><code>420-1572-man:~ mandreko$ msfconsole

 ______________________________________________________________________________
|                                                                              |
|                   METASPLOIT CYBER MISSILE COMMAND V4                        |
|______________________________________________________________________________|
      \                                  /                      /
       \     .                          /                      /            x
        \                              /                      /
         \                            /          +           /
          \            +             /                      /
           *                        /                      /
                                   /      .               /
    X                             /                      /            X
                                 /                     ###
                                /                     # % #
                               /                       ###
                      .       /
     .                       /      .            *           .
                            /
                           *
                  +                       *

                                       ^
####      __     __     __          #######         __     __     __        ####
####    /    \ /    \ /    \      ###########     /    \ /    \ /    \      ####
################################################################################
################################################################################
# WAVE 4 ######## SCORE 31337 ################################## HIGH FFFFFFFF #
################################################################################
                                                           http://metasploit.pro


       =[ metasploit v4.6.0-dev [core:4.6 api:1.0]
+ -- --=[ 1048 exploits - 589 auxiliary - 174 post
+ -- --=[ 275 payloads - 28 encoders - 8 nops

msf &gt;
</code></pre>

<p>Next, just load up the HSTS Scanner module and look at the options:</p>

<pre><code>msf &gt; use auxiliary/scanner/http/http_hsts 
msf  auxiliary(http_hsts) &gt; show options

Module options (auxiliary/scanner/http/http_hsts):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   Proxies                   no        Use a proxy chain
   RHOSTS                    yes       The target address range or CIDR identifier
   RPORT    443              yes       The target port
   SSL      true             yes       Negotiate SSL for outgoing connections
   THREADS  1                yes       The number of concurrent threads
   VHOST                     no        HTTP server virtual host

msf  auxiliary(http_hsts) &gt; 
</code></pre>

<p>Add the hosts that you want to scan, by setting the &ldquo;RHOSTS&rdquo; variable:</p>

<pre><code>msf  auxiliary(http_hsts) &gt; set rhosts www.paypal.com, www.google.com, www.yahoo.com, www.wikipedia.org
rhosts =&gt; www.paypal.com, www.google.com, www.yahoo.com, www.wikipedia.org
msf  auxiliary(http_hsts) &gt; 
</code></pre>

<p>Once you&rsquo;re ready, just run the module:</p>

<pre><code>msf  auxiliary(http_hsts) &gt; run

[+] 23.65.2.234:443 - Strict-Transport-Security:max-age=14400, max-age=14400
[-] 74.125.131.99:443 No HSTS found.
[*] Scanned 02 of 18 hosts (011% complete)
[-] 74.125.131.104:443 No HSTS found.
[-] 74.125.131.106:443 No HSTS found.
[*] Scanned 04 of 18 hosts (022% complete)
[-] 74.125.131.147:443 No HSTS found.
[-] 74.125.131.105:443 No HSTS found.
[*] Scanned 06 of 18 hosts (033% complete)
[-] 74.125.131.103:443 No HSTS found.
[*] Scanned 08 of 18 hosts (044% complete)
[-] 98.139.183.24:443 No HSTS found.
[*] Scanned 09 of 18 hosts (050% complete)
[*] Scanned 11 of 18 hosts (061% complete)
[*] Scanned 13 of 18 hosts (072% complete)
[*] Scanned 15 of 18 hosts (083% complete)
[-] 208.80.154.225:443 No HSTS found.
[*] Scanned 17 of 18 hosts (094% complete)
[*] Scanned 18 of 18 hosts (100% complete)
[*] Auxiliary module execution completed
msf  auxiliary(http_hsts) &gt; 
</code></pre>

<p>You can see that out of all of those hosts, paypal.com (23.65.2.234) was the only one that implemented the HSTS header.</p>

                </div>
                
              </article>
            </div>
          </div>
        </div>


      
      </div>
    </div>
    
    <div id='sidebar-wrapper'>
      <div class='sidebar ready-widget section' id='sidebar'>
        <div class='widget HTML' data-version='1' id='HTML3'>
	<h2 class='title'>Author</h2>
	<div class='widget-content'>
		<div class="sidebar_about_author">
			<div class="inner_wrapper">
				<div class="aboutme-img">
					<img alt="Author" class="img-responsive" height="388px" src="http://test.andreko.net/img/mattandreko_photo.jpg" title="Author (Matt Andreko)" width="300px">
				</div>
			</div>
			<div class="aboutme-info">
				<h4>Matt Andreko</h4>
				<p>Security Consultant</p>
			</div>
		</div>
	</div>
	<div class='clear'></div>
</div>
        <div class='RecentPosts' data-version='1' id='RecentPosts1'>
	<h2>Recent Posts</h2>
	<div class='widget-content recent-posts'>
		<ul>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='http://test.andreko.net/2014/12/17/compiling-sslscan-with-sslv2-support-on-osx/'>
							<img alt='Compiling SSLScan with SSLv2 support on OSX' border='0' height='72' src='http://test.andreko.net/img/sslscan_apple.png' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='http://test.andreko.net/2014/12/17/compiling-sslscan-with-sslv2-support-on-osx/'>Compiling SSLScan with SSLv2 support on OSX</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='http://test.andreko.net/2014/08/01/burp-icon-in-osx/'>
							<img alt='Burp Icon in OSX' border='0' height='72' src='http://test.andreko.net/img/automator_burp.png' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='http://test.andreko.net/2014/08/01/burp-icon-in-osx/'>Burp Icon in OSX</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='http://test.andreko.net/2014/01/13/backdoor-modules-for-netgear-linksys-and-other-routers/'>
							<img alt='Backdoor Modules for Netgear, Linksys, and Other Routers' border='0' height='72' src='http://test.andreko.net/img/backdoor_all_the_routers.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='http://test.andreko.net/2014/01/13/backdoor-modules-for-netgear-linksys-and-other-routers/'>Backdoor Modules for Netgear, Linksys, and Other Routers</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='http://test.andreko.net/2013/11/20/brainpan2/'>
							<img alt='Brainpan2' border='0' height='72' src='http://test.andreko.net/img/brainpan.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='http://test.andreko.net/2013/11/20/brainpan2/'>Brainpan2</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='http://test.andreko.net/2013/06/18/canon-y-u-no-security/'>
							<img alt='Canon, Y U NO Security?' border='0' height='72' src='http://test.andreko.net/img/y-u-no-guy.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='http://test.andreko.net/2013/06/18/canon-y-u-no-security/'>Canon, Y U NO Security?</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
		</ul>
		<div class='clear'></div>
	</div>
</div>

        <div class='widget Label' data-version='1' id='Label1'>
	<h2>Top Categories</h2>
	<div class='widget-content cloud-label-widget-content'>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/hacking'>hacking</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/wargames'>wargames</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/linux'>linux</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/exploit-exercises'>exploit-exercises</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/protostar'>protostar</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/overthewire'>overthewire</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/natas'>natas</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/nebula'>nebula</a>
			</span>
		
		<div class='clear'></div>
	</div>
</div>
      </div>
    </div>
    <div style='clear: both;'></div>
  </div>





		</div>
		
		<div id='w2t_footer'>
			<div class='w2t-copy-container row'>
				<div class='w2t_footer_copyright'>
					Copyright &copy;
					<script type='text/javascript'>
						var creditsyear = new Date();
						document.write(creditsyear.getFullYear());
					</script>
					Matt Andreko. All Rights Reserved
				</div>
			</div>
		</div>
		
		
			
				<script type="text/javascript">
	var disqus_shortname = 'mattandreko';
	var disqus_script = 'count.js';

	(function () {
		var dsq = document.createElement('script'); 
		dsq.type = 'text/javascript'; 
		dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
</script>
			
		
	</body>
</html>

